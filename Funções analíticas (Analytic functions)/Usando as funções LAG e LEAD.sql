/*
	LAG() — Pega o valor de uma coluna em uma linha anterior, em relação à linha atual.
	LEAD() — Pega o valor de uma coluna em uma linha seguinte, em relação à linha atual.
*/

CREATE TABLE #VENDA
(
	ID INT IDENTITY(1,1),
	VALOR DECIMAL(10,2),
	DATA_VENDA DATETIME
);

INSERT INTO #VENDA
	(VALOR, DATA_VENDA)
VALUES 
	(150.00, '2024-12-01 10:15:00'),
	(200.00, '2024-12-01 14:30:00'),
	(350.00, '2024-12-02 09:00:00'),
	(120.00, '2024-12-02 16:45:00'),
	(400.00, '2024-12-03 11:10:00'),
	(180.00, '2024-12-04 13:00:00'),
	(90.00,  '2024-12-05 08:25:00'),
	(600.00, '2024-12-05 19:40:00'),
	(220.00, '2024-12-06 15:55:00'),
	(300.00, '2024-12-07 17:20:00');


SELECT
	ID,
	DATA_VENDA,
	VALOR,
	LAG(VALOR,1) OVER (ORDER BY DATA_VENDA) AS VALOR_ANTERIOR,
	LEAD(VALOR,1) OVER (ORDER BY DATA_VENDA) AS VALOR_PROXIMA
FROM
	#VENDA

/*
Resultado:
+----+---------------------+--------+----------------+--------------+
| ID | DATA_VENDA          | VALOR  | VALOR_ANTERIOR | VALOR_PROXIMA|
+----+---------------------+--------+----------------+--------------+
|  1 | 2024-12-01 10:15:00 | 150.00 | NULL           | 200.00       |
|  2 | 2024-12-01 14:30:00 | 200.00 | 150.00         | 350.00       |
|  3 | 2024-12-02 09:00:00 | 350.00 | 200.00         | 120.00       |
|  4 | 2024-12-02 16:45:00 | 120.00 | 350.00         | 400.00       |
|  5 | 2024-12-03 11:10:00 | 400.00 | 120.00         | 180.00       |
|  6 | 2024-12-04 13:00:00 | 180.00 | 400.00         | 90.00        |
|  7 | 2024-12-05 08:25:00 | 90.00  | 180.00         | 600.00       |
|  8 | 2024-12-05 19:40:00 | 600.00 | 90.00          | 220.00       |
|  9 | 2024-12-06 15:55:00 | 220.00 | 600.00         | 300.00       |
| 10 | 2024-12-07 17:20:00 | 300.00 | 220.00         | NULL         |
+----+---------------------+--------+----------------+--------------+
*/